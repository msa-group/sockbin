<html>
<head>
  
  <meta charset="utf-8">

  <title>Sockbin - Websocket echoing service</title>
  <meta name=”description” content="Like httpbin, but for websockets.">

  <link rel="icon" href="http://i.imgur.com/H0h9uBV.png" type="image/png">
  <link rel="shortcut icon" href="http://i.imgur.com/H0h9uBV.png" type="image/png">

  <!-- Schema.org markup for Google+ -->
  <meta itemprop="name" content="Sockbin - Websocket echoing service">
  <meta itemprop="description" content="Like httpbin, but for websockets">
  <meta itemprop="image" content="http://i.imgur.com/H0h9uBV.png">
  
  <!-- Twitter Card data -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@therebelrobot">
  <meta name="twitter:title" content="Sockbin - Websocket echoing service">
  <meta name="twitter:description" content="Like httpbin, but for websockets">
  <meta name="twitter:creator" content="@therebelrobot">
  <meta name="twitter:image:src" content="http://i.imgur.com/H0h9uBV.png">
  
  <!-- Open Graph data -->
  <meta property="og:title" content="Sockbin - Websocket echoing service" />
  <meta property="og:type" content="profile" />
  <meta property="og:url" content="http://sockb.in" />
  <meta property="og:image" content="http://i.imgur.com/H0h9uBV.png" />
  <meta property="og:description" content="Like httpbin, but for websockets" />
  <meta property="og:site_name" content="Sockbin - Websocket echoing service" />
  <meta property="fb:admins" content="582330320" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="css/style.css">

  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" />
  <style rel="stylesheet" type="text/css">
    .col-sm-3 {
      margin:15px;
    }
    pre {
      height:200px;
      max-height:200px;
    }
  </style>
</head>
<body>

  <div class="container">
    <div class="row"><img src="https://raw.githubusercontent.com/therebelrobot/sockbin/master/sockbin-title-padding.png"/>
      <h1>Sockbin</h1>
      <p>
        <code>ws://sockb.in/</code>
      </p>
      <p>Websocket Echo service. Built with websocket-driver in Node.js</p>
    </div>
    <div class="row">
      <h2>Documentation</h2>
      <p>For usage documentation, refer to the <a href="https://github.com/therebelrobot/sockbin">Github README</a></p>
    </div>
  </div>
  <div class="container">
    <div class="row">
      <h1>Sockbin Playground</h1>
    </div>
    <div id="basic-websockets" class="col-sm-3">
      <div class="row">
        <h4>Basic</h4>
      </div>
      <div class="row">
        <pre><code id="basic-output"></code></pre>
      </div>
      <div class="row">
        <input id="basic-message" type="text" value="Hello Sockbin!" class="form-control"/>
      </div>
      <div class="row">
        <button id="basic-connect" class="btn btn-primary">Connect</button>
        <button id="basic-send" disabled="disabled" class="btn btn-default">Send Msg</button>
        <button id="basic-kill" class="btn btn-danger">Disconnect</button><br/><br/>
      </div>
    </div>
    <div id="custom-websockets" class="col-sm-3">
      <div class="row">
        <h4>Custom Response</h4>
      </div>
      <div class="row">
        <pre><code id="custom-output"></code></pre>
      </div>
      <div class="row">
        <input id="custom-message" type="text" value="Hello Sockbin!" class="form-control"/>
      </div>
      <div class="row">
        <button id="custom-connect" class="btn btn-primary">Connect</button>
        <button id="custom-send" disabled="disabled" class="btn btn-default">Send Msg</button>
        <button id="custom-kill" class="btn btn-danger">Disconnect</button><br/><br/>
      </div>
    </div>
    <div id="pipe-websockets" class="col-sm-3">
      <div class="row">
        <h4>Pipe External <code>GET</code>&nbsp;URL</h4>
      </div>
      <div class="row">
        <pre><code id="pipe-output"></code></pre>
      </div>
      <div class="row">
        <input id="pipe-message" type="text" value="Hello Sockbin!" class="form-control"/>
      </div>
      <div class="row">
        <button id="pipe-connect" class="btn btn-primary">Connect</button>
        <button id="pipe-send" disabled="disabled" class="btn btn-default">Send Msg</button>
        <button id="pipe-kill" class="btn btn-danger">Disconnect</button><br/><br/>
      </div>
    </div>
    <div id="delay-websockets" class="col-sm-3">
      <div class="row">
        <h4>Delay</h4>
      </div>
      <div class="row">
        <pre><code id="delay-output"></code></pre>
      </div>
      <div class="row">
        <input id="delay-message" type="text" value="Hello Sockbin!" class="form-control"/>
      </div>
      <div class="row">
        <button id="delay-connect" class="btn btn-primary">Connect</button>
        <button id="delay-send" disabled="disabled" class="btn btn-default">Send Msg</button>
        <button id="delay-kill" class="btn btn-danger">Disconnect</button><br/><br/>
      </div>
    </div>
    <div id="repeat-websockets" class="col-sm-3">
      <div class="row">
        <h4>Repeat</h4>
        <em>*defaults to min 5s delay</em>
      </div>
      <div class="row">
        <pre><code id="repeat-output"></code></pre>
      </div>
      <div class="row">
        <input id="repeat-message" type="text" value="Hello Sockbin!" class="form-control"/>
      </div>
      <div class="row">
        <button id="repeat-connect" class="btn btn-primary">Connect</button>
        <button id="repeat-send" disabled="disabled" class="btn btn-default">Send Msg</button>
        <button id="repeat-kill" class="btn btn-danger">Disconnect</button><br/><br/>
      </div>
    </div>
    <div id="delay-repeat-websockets" class="col-sm-3">
      <div class="row">
        <h4>Delay & Repeat</h4>
        <em>*defaults to min 5s delay</em>
      </div>
      <div class="row">
        <pre><code id="delay-repeat-output"></code></pre>
      </div>
      <div class="row">
        <input id="delay-repeat-message" type="text" value="Hello Sockbin!" class="form-control"/>
      </div>
      <div class="row">
        <button id="delay-repeat-connect" class="btn btn-primary">Connect</button>
        <button id="delay-repeat-send" disabled="disabled" class="btn btn-default">Send Msg</button>
        <button id="delay-repeat-kill" class="btn btn-danger">Disconnect</button><br/><br/>
      </div>
    </div>
    <div id="runfor-delay-websockets" class="col-sm-3">
      <div class="row">
        <h4>Run for & Delay</h4>
        <em>*defaults to min 5s delay</em>
      </div>
      <div class="row">
        <pre><code id="runfor-delay-output"></code></pre>
      </div>
      <div class="row">
        <input id="runfor-delay-message" type="text" value="Hello Sockbin!" class="form-control"/>
      </div>
      <div class="row">
        <button id="runfor-delay-connect" class="btn btn-primary">Connect</button>
        <button id="runfor-delay-send" disabled="disabled" class="btn btn-default">Send Msg</button>
        <button id="runfor-delay-kill" class="btn btn-danger">Disconnect</button><br/><br/>
      </div>
    </div>
  </div>
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js" type="text/javascript"></script>
  <script type="text/javascript">
  // https://github.com/therebelrobot/soxx

  $(document).ready(function () {
    setUp('/',{
      output:'basic-output',
      send:'basic-send',
      connect:'basic-connect',
      message:'basic-message',
      kill:'basic-kill'
    })
    setUp('/?response=%7Bfoo%3A%20bar%7D',{
      output:'custom-output',
      send:'custom-send',
      connect:'custom-connect',
      message:'custom-message',
      kill:'custom-kill'
    })
    setUp('/?pipe=http%3A%2F%2Fhttpbin.org%2Fget',{
      output:'pipe-output',
      send:'pipe-send',
      connect:'pipe-connect',
      message:'pipe-message',
      kill:'pipe-kill'
    })
    setUp('/delay/5000',{
      output:'delay-output',
      send:'delay-send',
      connect:'delay-connect',
      message:'delay-message',
      kill:'delay-kill'
    })
    setUp('/repeat/5',{
      output:'repeat-output',
      send:'repeat-send',
      connect:'repeat-connect',
      message:'repeat-message',
      kill:'repeat-kill'
    })
    setUp('/repeat/5/delay/5000',{
      output:'delay-repeat-output',
      send:'delay-repeat-send',
      connect:'delay-repeat-connect',
      message:'delay-repeat-message',
      kill:'delay-repeat-kill'
    })
    setUp('/runfor/1m/delay/5000',{
      output:'runfor-delay-output',
      send:'runfor-delay-send',
      connect:'runfor-delay-connect',
      message:'runfor-delay-message',
      kill:'runfor-delay-kill'
    })
  })

  function setUp (path, elements) {
    console.log(window.location)
    var wsUri = 'ws://' + window.location.host + path
    var output = document.getElementById(elements.output)

    var init = function init () {
      console.log('function init')
      writeToScreen('CONNECTING to '+path+' ...')
      testWebSocket()
    }

    var testWebSocket = function testWebSocket () {
      console.log('function testWebSockets')
      websocket = new WebSocket(wsUri)
      websocket.onopen = function (evt) {
        onOpen(evt)
      }
      websocket.onclose = function (evt) {
        onClose(evt)
      }
      websocket.onmessage = function (evt) {
        onMessage(evt)
      }
      websocket.onerror = function (evt) {
        onError(evt)
      }
    }

    var onOpen = function onOpen (evt) {
      console.log('function onOpen')
      writeToScreen('CONNECTED to '+path)
      $('#'+elements.send).attr('disabled', false)
    }

    var onClose = function onClose (evt) {
      console.log('function onClose')
      writeToScreen('DISCONNECTED from '+path)
    }

    var onMessage = function onMessage (evt) {
      console.log('function onMessage')
      writeToScreen('<span style="color: blue;">RESPONSE: ' + evt.data + '</span>')
    }

    var onError = function onError (evt) {
      console.log('function onError')
      writeToScreen('<span style="color: red;">ERROR:</span> ' + evt.data)
    }

    var doSend = function doSend (message) {
      console.log('function doSend')
      writeToScreen('SENT: ' + message)
      websocket.send(message)
    }

    var writeToScreen = function writeToScreen (message) {
      console.log('function writeToScreen')
      var pre = document.createElement('p')
      pre.style.wordWrap = 'break-word'
      pre.innerHTML = message
      output.appendChild(pre)
    }
    $('#'+elements.connect).on('click', init)
    $('#'+elements.send).on('click', function () {
      var message = $('#'+elements.message).val()
      doSend(message)
    })
    $('#'+elements.kill).on('click', function () {
      writeToScreen('DISCONNECTING from '+path+' ...')
      $('#'+elements.send).attr('disabled', true)
      websocket.close()
    })
  }

  </script>

</body>
</html>
